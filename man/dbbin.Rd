% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dbbin.R
\name{dbbin}
\alias{dbbin}
\title{Database-native binned regression}
\usage{
dbbin(
  fml,
  data,
  B = 20,
  degree = 1,
  smooth = 0,
  weights = NULL,
  partition_method = c("quantile", "equal", "log_equal", "manual"),
  breaks = NULL,
  ci = TRUE,
  vcov = NULL,
  level = 0.05,
  strategy = "auto",
  conn = NULL,
  verbose = TRUE
)
}
\arguments{
\item{fml}{A \code{\link[stats]{formula}} representing the binscatter relation.
Use the syntax \code{y ~ x} for unconditional binning, \code{y ~ x | controls} to
partial out controls, or \code{y ~ x | controls | fe} to include fixed effects.
For example: \code{mpg ~ wt | hp + cyl | gear}.}

\item{data}{A data source: R dataframe, database table name (character), or
dplyr::tbl object pointing to a database table.}

\item{B}{Integer number of bins. Default is 20.}

\item{degree}{Polynomial degree within bins: 0 (means), 1 (linear), or 2
(quadratic). Default is 1.}

\item{smooth}{Smoothness at bin boundaries: 0 (discontinuous), 1 (continuous
level), or 2 (continuous level and slope). Must satisfy \code{smooth <= degree}.
Default is 0. Values greater than 0 require the \code{dbplyr} package and
use constrained least squares estimation to enforce continuity at bin boundaries.}

\item{weights}{Character string naming the weight column. Default is NULL
(equal weights).}

\item{partition_method}{Bin partitioning method: "quantile" (equal-count bins),
"equal" (equal-width bins), "log_equal" (equal-width in log-space, for
right-skewed variables; requires x > 0), or "manual" (user-specified breaks).
Default is "quantile".}

\item{breaks}{Numeric vector of breakpoints if \code{partition_method = "manual"}.
Ignored otherwise.}

\item{ci}{Logical. Calculate standard errors and confidence intervals?
Default is FALSE.}

\item{vcov}{Character string or formula for standard errors. Options are
"iid" (default if ci=TRUE), "hc1", or a clustering formula like ~cluster_var.
Only supported for unconstrained estimation (smooth=0).}

\item{level}{Significance level for confidence intervals. Default is 0.05
(95\% confidence intervals). Only used when ci = TRUE.}

\item{strategy}{Acceleration strategy passed to dbreg when \code{smooth = 0}.
Options are "auto" (default), "compress", or "scan". This parameter is
ignored when \code{smooth > 0}. See \code{\link{dbreg}} for details.}

\item{conn}{Database connection. If NULL (default), an ephemeral DuckDB
connection will be created.}

\item{verbose}{Logical. Print progress messages? Default is TRUE.}
}
\value{
A data frame with bin-level results containing:
\itemize{
\item \code{bin}: bin number (1 to B)
\item \code{x_left}, \code{x_right}, \code{x_mid}: bin boundaries and midpoint
\item \code{n}: number of observations in bin
\item If \code{degree = 0}: \code{y} (fitted value at \code{x_mid})
\item If \code{degree = 1}: \code{y_left}, \code{y_right} (fitted values at bin boundaries,
defining a line segment)
\item If \code{degree = 2}: \code{y_left}, \code{y_mid}, \code{y_right} (fitted values at boundaries
and midpoint, defining a quadratic curve)
\item If \code{ci = TRUE}: \code{se}, \code{se_left}, \code{se_right}, \code{ci_low}, \code{ci_high} (and \verb{_left}/\verb{_right} variants)
\item Plus metadata: \code{B}, \code{degree}, \code{smooth}, \code{partition_method}
}
}
\description{
Performs binned regression entirely in SQL, returning plot-ready data with
estimated bin means or piecewise polynomial fits. Supports unconditional and
conditional models (with controls and/or fixed effects).
}
\examples{
\dontrun{
# Simple bin means
dbbin(mpg ~ wt, mtcars, B = 10, degree = 0)

# Piecewise linear fit
dbbin(mpg ~ wt, mtcars, B = 10, degree = 1)

# With controls
dbbin(mpg ~ wt | hp + cyl, mtcars, B = 10, degree = 1)

# With controls and fixed effects
dbbin(mpg ~ wt | hp + cyl | gear, mtcars, B = 10, degree = 1)
}
}

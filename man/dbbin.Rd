% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/dbbin.R
\name{dbbin}
\alias{dbbin}
\title{Database-native binned regression}
\usage{
dbbin(
  data,
  y,
  x,
  B = 20,
  degree = 1,
  smooth = 0,
  controls = NULL,
  fe = NULL,
  weights = NULL,
  partition_method = c("quantile", "equal", "log_equal", "manual"),
  breaks = NULL,
  ci = TRUE,
  vcov = NULL,
  level = 0.05,
  strategy = "auto",
  conn = NULL,
  verbose = TRUE
)
}
\arguments{
\item{data}{A data source: R dataframe, database table name (character), or
dplyr::tbl object pointing to a database table.}

\item{y}{Character string or unquoted name of the outcome variable.}

\item{x}{Character string or unquoted name of the binning variable.}

\item{B}{Integer number of bins. Default is 20.}

\item{degree}{Polynomial degree within bins: 0 (means), 1 (linear), or 2
(quadratic). Default is 1.}

\item{smooth}{Smoothness at bin boundaries: 0 (discontinuous), 1 (continuous
level), or 2 (continuous level and slope). Must satisfy `smooth <= degree`.
Default is 0. Values greater than 0 require the \code{dbplyr} package and
use constrained least squares estimation to enforce continuity at bin boundaries.}

\item{controls}{Optional formula specifying control variables, e.g. `~ z1 + z2`.
Default is NULL (no controls).}

\item{fe}{Optional formula specifying fixed effects using dbreg syntax, e.g.
`~ id + time`. Default is NULL (no fixed effects).}

\item{weights}{Character string naming the weight column. Default is NULL
(equal weights).}

\item{partition_method}{Bin partitioning method: "quantile" (equal-count bins),
"equal" (equal-width bins), "log_equal" (equal-width in log-space, for
right-skewed variables; requires x > 0), or "manual" (user-specified breaks).
Default is "quantile".}

\item{breaks}{Numeric vector of breakpoints if `partition_method = "manual"`.
Ignored otherwise.}

\item{ci}{Logical. Calculate standard errors and confidence intervals?
Default is FALSE.}

\item{vcov}{Character string or formula for standard errors. Options are
"iid" (default if ci=TRUE), "hc1", or a clustering formula like ~cluster_var.
Only supported for unconstrained estimation (smooth=0).}

\item{level}{Significance level for confidence intervals. Default is 0.05
(95% confidence intervals). Only used when ci = TRUE.}

\item{strategy}{Acceleration strategy passed to dbreg when `smooth = 0`.
Options are "auto" (default), "compress", or "scan". This parameter is
ignored when `smooth > 0`. See \code{\link{dbreg}} for details.}

\item{conn}{Database connection. If NULL (default), an ephemeral DuckDB
connection will be created.}

\item{verbose}{Logical. Print progress messages? Default is TRUE.}
}
\value{
A tibble with bin-level results containing:
  - `bin`: bin number (1 to B)
  - `x_left`, `x_right`, `x_mid`: bin boundaries and midpoint
  - `n`: number of observations in bin
  - If `degree = 0`: `y` (fitted value at `x_mid`)
  - If `degree = 1`: `y_left`, `y_right` (fitted values at bin boundaries,
    defining a line segment)
  - If `degree = 2`: `y_left`, `y_mid`, `y_right` (fitted values at boundaries
    and midpoint, defining a quadratic curve)
  - If `ci = TRUE`: `se`, `se_left`, `se_right`, `ci_low`, `ci_high` (and `_left`/`_right` variants)
  - Plus metadata: `B`, `degree`, `smooth`, `partition_method`
}
\description{
Performs binned regression entirely in SQL, returning plot-ready data with
estimated bin means or piecewise polynomial fits. Supports unconditional and
conditional models (with controls and/or fixed effects).
}
\examples{
\dontrun{
# Simple bin means
dbbin(mtcars, mpg, wt, B = 10, degree = 0)

# Piecewise linear fit
dbbin(mtcars, mpg, wt, B = 10, degree = 1)

# With controls
dbbin(mtcars, mpg, wt, controls = ~ hp + cyl, B = 10, degree = 1)
}
}

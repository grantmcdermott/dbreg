% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sql_model_matrix.R
\name{sql_model_matrix}
\alias{sql_model_matrix}
\title{Construct SQL expressions for a design matrix}
\usage{
sql_model_matrix(
  formula,
  conn,
  table,
  expand = c("all", "interactions"),
  sep = "_x_",
  fe_vars = character()
)
}
\arguments{
\item{formula}{A formula (or Formula) object. Only RHS terms are expanded;
the LHS (response variable) is ignored.}

\item{conn}{Database connection}

\item{table}{Table name or FROM clause}

\item{expand}{Character: `"all"` expands factors and interactions, 
`"interactions"` only expands interaction terms (factors in main effects 
kept as-is for grouping)}

\item{sep}{Character separator for interaction term names. Default is
`"_x_"`. Use `":"` for standard R naming convention.}

\item{fe_vars}{Character vector of fixed effect variable names. These are
treated as "in the model" for determining whether to drop reference levels
in interactions.}
}
\value{
List with:
  - `select_exprs`: character vector of SQL expressions
  - `col_names`: corresponding column names
  - `factor_levels`: list of factor levels by variable (for reference)
}
\description{
Expands formula terms into SQL SELECT expressions, handling factor one-hot
encoding and interaction terms. Only the right-hand side of the formula is
processed; the response variable (LHS) is ignored.
}
\examples{
\dontrun{
library(DBI)
library(duckdb)
con = dbConnect(duckdb())
duckdb_register(con, "test", data.frame(x1 = 1:3, x2 = c("a", "b", "c")))
sql_model_matrix(~ x1 + x2, con, "test")
sql_model_matrix(~ x1:x2, con, "test")
sql_model_matrix(~ x1:x2, con, "test", sep = ":")
dbDisconnect(con)
}
}

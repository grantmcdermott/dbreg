% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/duckreg.R
\name{duckreg}
\alias{duckreg}
\title{Run a compressed regression with a DuckDB backend.}
\usage{
duckreg(
  fml,
  conn = NULL,
  table = NULL,
  data = NULL,
  path = NULL,
  vcov = "hc1",
  query_only = FALSE,
  data_only = FALSE,
  strategy = c("auto", "group", "moments", "moments_fe"),
  compression_threshold = 0.001,
  verbose = TRUE,
  ridge_rel = 1e-12
)
}
\arguments{
\item{fml}{Formula. Use pipe for FEs: y ~ x1 + x2 | fe1 + fe2}

\item{conn}{DuckDB connection (optional).}

\item{table}{Character table name already in conn, or tbl_lazy object.}

\item{data}{Data frame to register (ignored if table given).}

\item{path}{DuckDB table function or path string.}

\item{vcov}{"hc1" or "ols".}

\item{query_only}{Return only SQL (group strategy only).}

\item{data_only}{Return compressed rows (group strategy only).}

\item{strategy}{"auto","group","moments","moments_fe".}

\item{compression_threshold}{Threshold for switching away from group in auto.}

\item{verbose}{Logical diagnostics.}

\item{ridge_rel}{Relative ridge (lambda = ridge_rel * mean(diag(X'X))) if Cholesky fails.}
}
\value{
List (class duckreg) with: coeftable, vcov, strategy, compression info, etc.
}
\description{
Internal strategies:
\enumerate{
\item group: GROUP BY regressors (+ fixed effects) -> frequency-weighted rows -> WLS.
\item moments: Global sufficient statistics (X'X, X'y) (no fixed effects).
\item moments_fe: One or two-way fixed-effect within (demean/double-demean) + cross-moments.
}

Auto heuristic:
\itemize{
\item If no FEs and (any regressor appears continuous OR estimated compression ratio > compression_threshold) => moments.
\item If 1-2 FEs and estimated compression ratio high (> max(0.6, compression_threshold)) => moments_fe.
\item Else group.
}

Notes:
\itemize{
\item Robust HC1: group path computes HC1; moments/moments_fe apply a df correction to classical variance.
}
}
\references{
Wong et al. (2021) arXiv:2102.11297
}
